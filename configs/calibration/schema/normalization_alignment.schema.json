{
  "$id": "https://spectramind.v50/schema/calibration/normalization_alignment.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Normalization, Detrending, and Temporal Alignment",
  "type": "object",
  "allOf": [
    { "$ref": "common_defs.schema.json#/$defs/enabled" },
    {
      "type": "object",
      "properties": {
        "normalization": { "$ref": "common_defs.schema.json#/$defs/enum_normalize" },
        "clip_outliers": { "type": "boolean", "default": false },
        "clip_sigma": { "type": "number", "minimum": 0.0, "default": 6.0 },
        "detrend": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "regressors": {
              "type": "array",
              "items": { "$ref": "common_defs.schema.json#/$defs/enum_regressor" },
              "minItems": 0
            },
            "method": { "enum": ["ols", "ridge", "lasso", "elasticnet"] },
            "alpha": { "type": "number", "minimum": 0.0, "default": 0.1 }
          },
          "required": ["enabled"],
          "additionalProperties": false
        },
        "resample": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "method": { "enum": ["nearest", "linear", "cubic", "pchip"] },
            "target_dt_s": { "$ref": "common_defs.schema.json#/$defs/positive_number" }
          },
          "required": ["enabled"],
          "additionalProperties": false
        },
        "align_to_fgs1": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "strategy": { "enum": ["xcorr", "feature", "phase"] },
            "max_shift_frames": { "$ref": "common_defs.schema.json#/$defs/non_negative_integer" }
          },
          "required": ["enabled"],
          "additionalProperties": false
        }
      },
      "required": ["enabled", "normalization"],
      "additionalProperties": false
    }
  ]
}
